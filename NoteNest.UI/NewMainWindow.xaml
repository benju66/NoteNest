<Window x:Class="NoteNest.UI.NewMainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:NoteNest.UI"
        Title="NoteNest - New Architecture" Height="600" Width="1000">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Toolbar -->
        <ToolBar Grid.Row="0">
            <Button Content="New Note" Command="{Binding NoteOperations.CreateNoteCommand}" />
            <Button Content="Save" Command="{Binding Workspace.SaveTabCommand}" 
                    CommandParameter="{Binding Workspace.SelectedTab}" />
            <Button Content="Save All" Command="{Binding Workspace.SaveAllTabsCommand}" />
            <Separator />
            <Button Content="Refresh" Command="{Binding RefreshCommand}" />
            <Separator />
            <Button Content="Settings" Click="SettingsMenuItem_Click" ToolTip="Open application settings" />
        </ToolBar>
        
        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" MinWidth="200"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Category Tree -->
            <GroupBox Grid.Column="0" Header="Categories">
                <TreeView ItemsSource="{Binding CategoryTree.Categories}">
                    <TreeView.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}" />
                        </DataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </GroupBox>
            
            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" />
            
            <!-- Workspace Area -->
            <GroupBox Grid.Column="2" Header="Workspace">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Tab Bar -->
                    <TabControl Grid.Row="0" ItemsSource="{Binding Workspace.OpenTabs}" 
                               SelectedItem="{Binding Workspace.SelectedTab}">
                        <TabControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Title}" />
                                    <TextBlock Text="*" Visibility="{Binding IsDirty, Converter={x:Static local:BoolToVisibilityConverter.Instance}}" 
                                              Foreground="Red" Margin="2,0,0,0"/>
                                </StackPanel>
                            </DataTemplate>
                        </TabControl.ItemTemplate>
                           <TabControl.ContentTemplate>
                               <DataTemplate>
                                   <Grid>
                                       <!-- Rich Text Editor -->
                                       <RichTextBox Name="NoteEditor"
                                                   AcceptsReturn="True"
                                                   AcceptsTab="True"
                                                   VerticalScrollBarVisibility="Auto"
                                                   HorizontalScrollBarVisibility="Auto"
                                                   FontFamily="Consolas"
                                                   FontSize="12"
                                                   Padding="10"
                                                   Background="White"
                                                   BorderBrush="LightGray"
                                                   BorderThickness="1">
                                           <!-- For now, we'll use a simple binding approach -->
                                           <!-- In a full implementation, we'd create a custom attached property for RTF binding -->
                                       </RichTextBox>
                                       
                                       <!-- Fallback TextBox for now (while we implement RTF binding) -->
                                       <TextBox Text="{Binding Content, UpdateSourceTrigger=PropertyChanged}" 
                                                AcceptsReturn="True" 
                                                AcceptsTab="True"
                                                VerticalScrollBarVisibility="Auto"
                                                HorizontalScrollBarVisibility="Auto"
                                                FontFamily="Consolas"
                                                FontSize="12"
                                                Padding="10"
                                                Background="White"
                                                BorderBrush="LightGray"
                                                BorderThickness="1"
                                                TextWrapping="Wrap"/>
                                   </Grid>
                               </DataTemplate>
                           </TabControl.ContentTemplate>
                    </TabControl>
                    
                    <!-- Placeholder when no tabs -->
                    <TextBlock Grid.Row="1" Text="No notes open. Select a category and click 'New Note' to get started." 
                              HorizontalAlignment="Center" 
                              VerticalAlignment="Center" 
                              Foreground="Gray"
                              Visibility="{Binding Workspace.OpenTabs.Count, Converter={x:Static local:CountToVisibilityConverter.Instance}}"/>
                </Grid>
            </GroupBox>
        </Grid>
        
        <!-- Status Bar -->
        <StatusBar Grid.Row="2">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="{Binding IsLoading, Converter={x:Static local:BoolToTextConverter.Instance}}" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>