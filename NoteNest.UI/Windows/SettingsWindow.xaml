<Window x:Class="NoteNest.UI.Windows.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:ui="http://schemas.modernwpf.com/2019"
        xmlns:converters="clr-namespace:NoteNest.UI.Converters"
        ui:WindowHelper.UseModernWindowStyle="True"
        Title="Settings" Height="550" Width="750"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        ResizeMode="NoResize">
    
    <Grid>
        <ui:NavigationView PaneDisplayMode="Left" IsBackButtonVisible="Collapsed" 
                          IsSettingsVisible="False" IsPaneToggleButtonVisible="False"
                          SelectionChanged="NavigationView_SelectionChanged">
            <ui:NavigationView.MenuItems>
                <ui:NavigationViewItem Content="General" Tag="General">
                    <ui:NavigationViewItem.Icon>
                        <ui:SymbolIcon Symbol="Home"/>
                    </ui:NavigationViewItem.Icon>
                </ui:NavigationViewItem>
                <ui:NavigationViewItem Content="Appearance" Tag="Appearance">
                    <ui:NavigationViewItem.Icon>
                        <ui:SymbolIcon Symbol="Setting"/>
                    </ui:NavigationViewItem.Icon>
                </ui:NavigationViewItem>
                <ui:NavigationViewItem Content="Editor" Tag="Editor">
                    <ui:NavigationViewItem.Icon>
                        <ui:SymbolIcon Symbol="Edit"/>
                    </ui:NavigationViewItem.Icon>
                </ui:NavigationViewItem>
                <ui:NavigationViewItem Content="Files &amp; Folders" Tag="Files">
                    <ui:NavigationViewItem.Icon>
                        <ui:SymbolIcon Symbol="Folder"/>
                    </ui:NavigationViewItem.Icon>
                </ui:NavigationViewItem>
                <ui:NavigationViewItem Content="Storage" Tag="Storage">
                    <ui:NavigationViewItem.Icon>
                        <ui:SymbolIcon Symbol="Save"/>
                    </ui:NavigationViewItem.Icon>
                </ui:NavigationViewItem>
                <ui:NavigationViewItem Content="Features" Tag="Features">
                    <ui:NavigationViewItem.Icon>
                        <ui:SymbolIcon Symbol="ViewAll"/>
                    </ui:NavigationViewItem.Icon>
                </ui:NavigationViewItem>
                <ui:NavigationViewItem Content="Advanced" Tag="Advanced">
                    <ui:NavigationViewItem.Icon>
                        <ui:SymbolIcon Symbol="Setting"/>
                    </ui:NavigationViewItem.Icon>
                </ui:NavigationViewItem>
            </ui:NavigationView.MenuItems>
            
            <ScrollViewer Padding="20">
                <StackPanel x:Name="ContentPanel">
                    <!-- General Settings Page -->
                    <StackPanel x:Name="GeneralSettings" Visibility="Visible">
                        <TextBlock Text="General Settings" Style="{StaticResource TitleTextBlockStyle}" Margin="0,0,0,16"/>
                        
                        <ui:ToggleSwitch Header="Enable auto-save" 
                                        IsOn="{Binding Settings.AutoSave}"
                                        Margin="0,8"/>
                        
                        <ui:NumberBox Header="Auto-save interval (seconds)" 
                                     Value="{Binding Settings.AutoSaveInterval}"
                                     Minimum="10" Maximum="600"
                                     IsEnabled="{Binding Settings.AutoSave}"
                                     Margin="0,8"/>
                        
                        <ui:ToggleSwitch Header="Show welcome screen on startup" 
                                        IsOn="{Binding Settings.ShowWelcomeScreen}"
                                        Margin="0,8"/>
                        
                        <ui:ToggleSwitch Header="Check for updates automatically" 
                                        IsOn="{Binding Settings.CheckForUpdates}"
                                        Margin="0,8"/>
                    </StackPanel>
                    
                    <!-- Appearance Settings Page -->
                    <StackPanel x:Name="AppearanceSettings" Visibility="Collapsed">
                        <TextBlock Text="Appearance" Style="{StaticResource TitleTextBlockStyle}" Margin="0,0,0,16"/>
                        
                        <TextBlock Text="Theme" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,8"/>
                        <ui:RadioButtons>
                            <RadioButton x:Name="LightThemeRadio" Content="Light"/>
                            <RadioButton x:Name="DarkThemeRadio" Content="Dark"/>
                            <RadioButton x:Name="SystemThemeRadio" Content="Use system setting"/>
                        </ui:RadioButtons>
                        
                        <TextBlock Text="Accent Color" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,16,0,8"/>
                        <ui:GridView SelectionMode="Single">
                            <Rectangle Width="40" Height="40" Fill="#0078D4" RadiusX="4" RadiusY="4"/>
                            <Rectangle Width="40" Height="40" Fill="#E74856" RadiusX="4" RadiusY="4"/>
                            <Rectangle Width="40" Height="40" Fill="#0099BC" RadiusX="4" RadiusY="4"/>
                            <Rectangle Width="40" Height="40" Fill="#7A7574" RadiusX="4" RadiusY="4"/>
                            <Rectangle Width="40" Height="40" Fill="#767676" RadiusX="4" RadiusY="4"/>
                            <Rectangle Width="40" Height="40" Fill="#FF8C00" RadiusX="4" RadiusY="4"/>
                            <Rectangle Width="40" Height="40" Fill="#E81123" RadiusX="4" RadiusY="4"/>
                            <Rectangle Width="40" Height="40" Fill="#0063B1" RadiusX="4" RadiusY="4"/>
                        </ui:GridView>
                    </StackPanel>
                    
                    <!-- Editor Settings Page -->
                    <StackPanel x:Name="EditorSettings" Visibility="Collapsed">
                        <TextBlock Text="Editor Settings" Style="{StaticResource TitleTextBlockStyle}" Margin="0,0,0,16"/>
                        
                        <ui:ToggleSwitch Header="Enable word wrap" 
                                        IsOn="{Binding Settings.WordWrap}"
                                        Margin="0,8"/>
                        
                        <ui:ToggleSwitch Header="Show line numbers" 
                                        IsOn="{Binding Settings.ShowLineNumbers}"
                                        Margin="0,8"/>
                        
                        <ui:ToggleSwitch Header="Show status bar" 
                                        IsOn="{Binding Settings.ShowStatusBar}"
                                        Margin="0,8"/>
                        
                        <ui:ToggleSwitch Header="Highlight current line" 
                                        IsOn="{Binding Settings.HighlightCurrentLine}"
                                        Margin="0,8"/>
                        
                        <TextBlock Text="Font" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,16,0,8"/>

                        <TextBlock Text="Font family" Style="{StaticResource BaseTextBlockStyle}"/>
                        <ComboBox 
                                  SelectedItem="{Binding Settings.FontFamily}"
                                  Margin="0,8,0,0">
                            <ComboBoxItem>Consolas</ComboBoxItem>
                            <ComboBoxItem>Courier New</ComboBoxItem>
                            <ComboBoxItem>Segoe UI</ComboBoxItem>
                            <ComboBoxItem>Cascadia Code</ComboBoxItem>
                            <ComboBoxItem>Fira Code</ComboBoxItem>
                        </ComboBox>
                        
                        <ui:NumberBox Header="Font size" 
                                     Value="{Binding Settings.FontSize}"
                                     Minimum="8" Maximum="32"
                                     Margin="0,8"/>
                        
                        <TextBlock Text="Tab Settings" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,16,0,8"/>
                        
                        <ui:NumberBox Header="Tab size" 
                                     Value="{Binding Settings.TabSize}"
                                     Minimum="2" Maximum="8"
                                     Margin="0,8"/>
                        
                        <ui:ToggleSwitch Header="Insert spaces instead of tabs" 
                                        IsOn="{Binding Settings.InsertSpaces}"
                                        Margin="0,8"/>
                    </StackPanel>
                    
                    <!-- Files & Folders Settings Page -->
                    <StackPanel x:Name="FilesSettings" Visibility="Collapsed">
                        <TextBlock Text="Files &amp; Folders" Style="{StaticResource TitleTextBlockStyle}" Margin="0,0,0,16"/>
                        
                        <TextBlock Text="Default notes path" Style="{StaticResource BaseTextBlockStyle}" Margin="0,8,0,4"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0" Text="{Binding Settings.DefaultNotePath}" 
                                     IsReadOnly="True" Margin="0,0,8,0"/>
                            <Button Grid.Column="1" Content="Browse..." 
                                    Command="{Binding BrowseDefaultPathCommand}"/>
                        </Grid>
                        
                        <TextBlock Text="Metadata path" Style="{StaticResource BaseTextBlockStyle}" Margin="0,16,0,4"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0" Text="{Binding Settings.MetadataPath}" 
                                     IsReadOnly="True" Margin="0,0,8,0"/>
                            <Button Grid.Column="1" Content="Browse..." 
                                    Command="{Binding BrowseMetadataPathCommand}"/>
                        </Grid>
                        
                        <ui:ToggleSwitch Header="Create backup before saving" 
                                        IsOn="{Binding Settings.CreateBackup}"
                                        Margin="0,16,0,8"/>
                        
                        <ui:NumberBox Header="Maximum backup files per note" 
                                     Value="{Binding Settings.MaxBackups}"
                                     Minimum="1" Maximum="50"
                                     IsEnabled="{Binding Settings.CreateBackup}"
                                     Margin="0,8"/>
                    </StackPanel>

                    <!-- Storage Settings Page -->
                    <StackPanel x:Name="StorageSettings" Visibility="Collapsed">
                        <TextBlock Text="Storage Location" Style="{StaticResource TitleTextBlockStyle}" 
                                   Margin="0,0,0,16"/>
                        
                        <!-- Current Location Display -->
                        <Border Background="{DynamicResource SystemControlBackgroundBaseLowBrush}"
                                BorderBrush="{DynamicResource SystemControlForegroundBaseMediumLowBrush}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="12,8"
                                Margin="0,0,0,16">
                            <StackPanel>
                                <TextBlock Text="Current storage location:" 
                                           FontWeight="SemiBold"
                                           Margin="0,0,0,4"/>
                                <TextBlock Text="{Binding CurrentStoragePath}" 
                                           TextWrapping="Wrap"
                                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                            </StackPanel>
                        </Border>
                        
                        <TextBlock Text="Choose where to store your notes:" 
                                   Style="{StaticResource BaseTextBlockStyle}" 
                                   Margin="0,0,0,8"/>
                        
                        <RadioButton IsChecked="{Binding UseLocalStorage}" Margin="0,4">
                            <StackPanel>
                                <TextBlock Text="Local Storage" FontWeight="SemiBold"/>
                                <TextBlock Text="Store in Documents/NoteNest folder" 
                                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                            </StackPanel>
                        </RadioButton>
                        
                        <RadioButton IsChecked="{Binding UseOneDrive}" Margin="0,4">
                            <StackPanel>
                                <TextBlock Text="OneDrive" FontWeight="SemiBold"/>
                                <TextBlock Text="Automatic sync across devices" 
                                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                            </StackPanel>
                        </RadioButton>
                        
                        <RadioButton IsChecked="{Binding UseCustomPath}" Margin="0,4">
                            <StackPanel>
                                <TextBlock Text="Custom Location" FontWeight="SemiBold"/>
                                <TextBlock Text="Choose your own folder" 
                                           Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"/>
                            </StackPanel>
                        </RadioButton>
                        
                        <Grid Margin="20,8,0,0" IsEnabled="{Binding UseCustomPath}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0" Text="{Binding CustomPath}" 
                                     IsReadOnly="True" Margin="0,0,8,0"/>
                            <Button Grid.Column="1" Content="Browse..." 
                                    Command="{Binding BrowseCustomPathCommand}"/>
                        </Grid>
                        
                        <Separator Margin="0,20"/>
                        
                        <Button Content="Move Existing Notes to New Location..." 
                                Margin="0,8"
                                HorizontalAlignment="Left"
                                Click="MigrateNotes_Click"/>
                        
                        <TextBlock Text="Note: After changing storage location, a restart is required." 
                                   FontStyle="Italic"
                                   Foreground="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                                   Margin="0,8,0,0"/>
                    </StackPanel>

                    <!-- Features Settings Page -->
                    <StackPanel x:Name="FeaturesSettings" Visibility="Collapsed">
                        <TextBlock Text="Features" Style="{StaticResource TitleTextBlockStyle}" 
                                   Margin="0,0,0,16"/>
                        
                        <TextBlock Text="Default file format" Style="{StaticResource BaseTextBlockStyle}" 
                                   Margin="0,0,0,4"/>
                        <ComboBox SelectedValue="{Binding Settings.DefaultNoteFormat}" 
                                  Margin="0,0,0,16">
                            <ComboBoxItem Content="Plain Text (.txt)" Tag=".txt"/>
                            <ComboBoxItem Content="Markdown (.md)" Tag=".md"/>
                        </ComboBox>
                        
                        <ui:ToggleSwitch Header="Enable Task Management" 
                                         IsOn="{Binding Settings.EnableTaskPanel}"
                                         Margin="0,8"/>
                        
                        <ui:ToggleSwitch Header="Sync markdown checkboxes with tasks" 
                                         IsOn="{Binding Settings.ParseMarkdownCheckboxes}"
                                         IsEnabled="{Binding Settings.EnableTaskPanel}"
                                         Margin="20,8,0,8"/>
                        
                        <TextBlock Text="Keyboard Shortcuts" Style="{StaticResource SubtitleTextBlockStyle}" 
                                   Margin="0,16,0,8"/>
                        
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Quick Note:" 
                                       VerticalAlignment="Center"/>
                            <TextBox Grid.Row="0" Grid.Column="1" 
                                     Text="{Binding Settings.QuickNoteHotkey}"
                                     Margin="0,4"/>
                            
                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Quick Task:" 
                                       VerticalAlignment="Center"/>
                            <TextBox Grid.Row="1" Grid.Column="1" 
                                     Text="{Binding Settings.QuickTaskHotkey}"
                                     Margin="0,4"/>
                        </Grid>
                    </StackPanel>

                    <!-- Advanced Settings Page -->
                    <StackPanel x:Name="AdvancedSettings" Visibility="Collapsed">
                        <TextBlock Text="Advanced Settings" Style="{StaticResource TitleTextBlockStyle}" Margin="0,0,0,16"/>

                        <TextBlock Text="File Watcher" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,8"/>
                        <ui:NumberBox Header="Debounce (ms)"
                                     Value="{Binding Settings.FileWatcherDebounceMs}"
                                     Minimum="50" Maximum="60000"
                                     Margin="0,8"/>
                        <ui:NumberBox Header="Buffer (KB)"
                                     Value="{Binding Settings.FileWatcherBufferKB}"
                                     Minimum="4" Maximum="2048"
                                     Margin="0,8"/>

                        <TextBlock Text="Content Cache" Style="{StaticResource SubtitleTextBlockStyle}" Margin="16,16,0,8"/>
                        <ui:NumberBox Header="Max Size (MB)"
                                     Value="{Binding Settings.ContentCacheMaxMB}"
                                     Minimum="10" Maximum="2048"
                                     Margin="0,8"/>
                        <ui:NumberBox Header="Expiration (minutes)"
                                     Value="{Binding Settings.ContentCacheExpirationMinutes}"
                                     Minimum="1" Maximum="43200"
                                     Margin="0,8"/>
                        <ui:NumberBox Header="Cleanup Interval (minutes)"
                                     Value="{Binding Settings.ContentCacheCleanupMinutes}"
                                     Minimum="1" Maximum="43200"
                                     Margin="0,8"/>

                        <TextBlock Text="Search Index" Style="{StaticResource SubtitleTextBlockStyle}" Margin="16,16,0,8"/>
                        <ui:NumberBox Header="Content Word Limit"
                                     Value="{Binding Settings.SearchIndexContentWordLimit}"
                                     Minimum="100" Maximum="100000"
                                     Margin="0,8"/>

                        <TextBlock Text="App Settings Save" Style="{StaticResource SubtitleTextBlockStyle}" Margin="16,16,0,8"/>
                        <ui:NumberBox Header="Settings Save Debounce (ms)"
                                     Value="{Binding Settings.SettingsSaveDebounceMs}"
                                     Minimum="100" Maximum="600000"
                                     Margin="0,8"/>

                        <TextBlock Text="Auto-save" Style="{StaticResource SubtitleTextBlockStyle}" Margin="16,16,0,8"/>
                        <ui:ToggleSwitch Header="Enable adaptive idle auto-save"
                                        IsOn="{Binding Settings.AdaptiveAutoSaveEnabled}"
                                        Margin="0,8"/>
                        <StackPanel Orientation="Horizontal" Margin="0,8" IsEnabled="{Binding Settings.AdaptiveAutoSaveEnabled}">
                            <TextBlock Text="Adaptive preset:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <ComboBox SelectedItem="{Binding Settings.AdaptiveAutoSavePreset}" Width="160">
                                <ComboBoxItem>Conservative</ComboBoxItem>
                                <ComboBoxItem>Balanced</ComboBoxItem>
                                <ComboBoxItem>Aggressive</ComboBoxItem>
                            </ComboBox>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </ui:NavigationView>
        
        <!-- Bottom Buttons -->
        <StackPanel Orientation="Horizontal" 
                    HorizontalAlignment="Right" 
                    VerticalAlignment="Bottom" 
                    Margin="20">
            <Button Content="OK" Width="80" Margin="0,0,8,0" 
                    Style="{StaticResource AccentButtonStyle}"
                    Click="OK_Click"/>
            <Button Content="Cancel" Width="80" Click="Cancel_Click"/>
        </StackPanel>
    </Grid>
</Window>
