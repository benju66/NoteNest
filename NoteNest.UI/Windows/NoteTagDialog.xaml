<Window x:Class="NoteNest.UI.Windows.NoteTagDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Note Tags" 
        Height="550" Width="500"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource AppBackgroundBrush}"
        Foreground="{DynamicResource AppTextPrimaryBrush}"
        ResizeMode="CanResize">
    
    <Window.Resources>
        <!-- Import Lucide icons -->
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Resources/LucideIcons.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        </ResourceDictionary>
    </Window.Resources>
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Note info -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Note Tags" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,4"/>
            <TextBlock x:Name="NotePathText" 
                       Text="Note: " 
                       FontSize="12" 
                       Foreground="{DynamicResource AppTextSecondaryBrush}"/>
        </StackPanel>
        
        <!-- Tags display -->
        <StackPanel Grid.Row="1" Margin="0,0,0,12">
            <TextBlock Text="Add or remove tags below, then click Save to apply changes." 
                       FontSize="11" 
                       Foreground="{DynamicResource AppTextSecondaryBrush}"
                       Margin="0,0,0,8"
                       TextWrapping="Wrap"/>
            
            <!-- Inherited tags from parent folder (read-only) -->
            <TextBlock Text="Inherited from Parent Folder:" 
                       FontWeight="SemiBold" 
                       Margin="0,0,0,4"
                       Visibility="{Binding ElementName=InheritedTagsListBox, Path=HasItems, Converter={StaticResource BoolToVisibilityConverter}}"/>
            <ListBox x:Name="InheritedTagsListBox"
                     MaxHeight="60"
                     Background="{DynamicResource AppSurfaceBrush}"
                     BorderBrush="{DynamicResource AppBorderBrush}"
                     Foreground="{DynamicResource AppTextSecondaryBrush}"
                     Margin="0,0,0,8"
                     IsEnabled="False">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <ContentControl Template="{StaticResource LucideZap}"
                                            Width="12" Height="12" 
                                            Foreground="#10B981"
                                            Margin="0,0,6,0"
                                            VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding}" VerticalAlignment="Center" FontStyle="Italic"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
            
            <!-- This note's own tags (editable) -->
            <TextBlock Text="This Note's Tags:" FontWeight="SemiBold" Margin="0,0,0,4"/>
            <ListBox x:Name="TagsListBox"
                     Height="120"
                     Background="{DynamicResource AppSurfaceBrush}"
                     BorderBrush="{DynamicResource AppBorderBrush}"
                     Foreground="{DynamicResource AppTextPrimaryBrush}">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <ContentControl Template="{StaticResource LucideTag}"
                                            Width="14" Height="14" 
                                            Foreground="{DynamicResource AppAccentBrush}"
                                            Margin="0,0,8,0"
                                            VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </StackPanel>
        
        <!-- Add new tag -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,12" VerticalAlignment="Top">
            <TextBox x:Name="NewTagTextBox" 
                     Width="300" 
                     Height="28"
                     VerticalContentAlignment="Center"
                     Background="{DynamicResource AppSurfaceBrush}"
                     Foreground="{DynamicResource AppTextPrimaryBrush}"
                     BorderBrush="{DynamicResource AppBorderBrush}"
                     KeyDown="NewTagTextBox_KeyDown"/>
            <Button Content="Add Tag" 
                    Width="80" 
                    Height="28"
                    Margin="8,0,0,0"
                    Background="{DynamicResource AppAccentBrush}"
                    Foreground="White"
                    BorderThickness="0"
                    Click="AddTag_Click"/>
            <Button Content="Remove" 
                    Width="80" 
                    Height="28"
                    Margin="8,0,0,0"
                    Background="{DynamicResource AppSurfaceBrush}"
                    Foreground="{DynamicResource AppTextPrimaryBrush}"
                    BorderBrush="{DynamicResource AppBorderBrush}"
                    BorderThickness="1"
                    Click="RemoveTag_Click"
                    x:Name="RemoveTagButton"/>
        </StackPanel>
        
        <!-- Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Save" 
                    Width="80" 
                    Height="32"
                    Margin="0,0,8,0"
                    Background="{DynamicResource AppAccentBrush}"
                    Foreground="White"
                    BorderThickness="0"
                    Click="Save_Click"
                    IsDefault="True"/>
            <Button Content="Cancel" 
                    Width="80" 
                    Height="32"
                    Background="{DynamicResource AppSurfaceBrush}"
                    Foreground="{DynamicResource AppTextPrimaryBrush}"
                    BorderBrush="{DynamicResource AppBorderBrush}"
                    BorderThickness="1"
                    Click="Cancel_Click"
                    IsCancel="True"/>
        </StackPanel>
    </Grid>
</Window>

