<UserControl x:Class="NoteNest.UI.Controls.Workspace.PaneView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:workspace="clr-namespace:NoteNest.UI.Controls.Workspace"
             xmlns:converters="clr-namespace:NoteNest.UI.Converters">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:ActivePaneBorderConverter x:Key="ActivePaneBorderConverter"/>
        <converters:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Border BorderThickness="2" BorderBrush="{Binding IsActive, Converter={StaticResource ActivePaneBorderConverter}}">
        <Grid>
            <!-- Professional TabControl with close buttons -->
            <TabControl ItemsSource="{Binding Tabs}" 
                       SelectedItem="{Binding SelectedTab, Mode=TwoWay}"
                       HorizontalAlignment="Stretch"
                       VerticalAlignment="Stretch"
                       GotFocus="TabControl_GotFocus">
                <TabControl.ItemTemplate>
                    <DataTemplate>
                        <!-- Professional tab header with close button (from Milestone 1) -->
                        <Grid MaxWidth="200" ToolTip="{Binding Note.FilePath}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>       <!-- Title -->
                                <ColumnDefinition Width="Auto"/>    <!-- Dirty indicator -->
                                <ColumnDefinition Width="24"/>      <!-- Close button -->
                            </Grid.ColumnDefinitions>
                            
                            <!-- Title with ellipsis truncation -->
                            <TextBlock Grid.Column="0" 
                                       Text="{Binding Title}"
                                       TextTrimming="CharacterEllipsis"
                                       Margin="8,4,4,4"
                                       VerticalAlignment="Center"/>
                            
                            <!-- Dirty indicator -->
                            <TextBlock Grid.Column="1" 
                                       Text="·" 
                                       Visibility="{Binding IsDirty, Converter={StaticResource BoolToVisibilityConverter}}"
                                       Foreground="#FFE57A"
                                       FontWeight="Bold"
                                       FontSize="16"
                                       Margin="2,4"
                                       VerticalAlignment="Center"/>
                            
                            <!-- Close button -->
                            <Button Grid.Column="2"
                                    Content="×"
                                    Click="CloseTab_Click"
                                    Tag="{Binding}"
                                    Width="20" Height="20"
                                    Margin="2,2"
                                    Background="Transparent"
                                    BorderThickness="0"
                                    FontSize="14"
                                    FontWeight="Bold"
                                    ToolTip="Close tab (Ctrl+W)">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Foreground" Value="#888"/>
                                        <Setter Property="Cursor" Value="Hand"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Foreground" Value="#FFF"/>
                                                <Setter Property="Background" Value="#40FF0000"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </Grid>
                    </DataTemplate>
                </TabControl.ItemTemplate>
                <TabControl.ContentTemplate>
                    <DataTemplate>
                        <!-- TabContentView hosts the RTF editor -->
                        <workspace:TabContentView DataContext="{Binding}"
                                                 HorizontalAlignment="Stretch"
                                                 VerticalAlignment="Stretch"/>
                    </DataTemplate>
                </TabControl.ContentTemplate>
            </TabControl>
            
            <!-- Placeholder when no tabs -->
            <TextBlock Text="No tabs in this pane" 
                      HorizontalAlignment="Center" 
                      VerticalAlignment="Center" 
                      Foreground="Gray"
                      FontStyle="Italic"
                      IsHitTestVisible="False">
                <TextBlock.Visibility>
                    <Binding Path="Tabs.Count">
                        <Binding.Converter>
                            <converters:CountToVisibilityConverter/>
                        </Binding.Converter>
                    </Binding>
                </TextBlock.Visibility>
            </TextBlock>
        </Grid>
    </Border>
</UserControl>
